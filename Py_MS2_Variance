from openpyxl import load_workbook, Workbook

input_file = "VarianceCommentarySourceFile.xlsx"
output_file = "VarianceCommentaryOutputFile.xlsx"

required_sheets = ["SoFP", "SoPL"]

wb_in = load_workbook(input_file, data_only=True)
wb_out = Workbook()

# Remove the default sheet created by openpyxl
default_sheet = wb_out.active
wb_out.remove(default_sheet)

for sheet_name in required_sheets:
    if sheet_name not in wb_in.sheetnames:
        print(f"Warning: Sheet '{sheet_name}' not found in the input file.")
        continue

    ws_in = wb_in[sheet_name]
    new_sheet_name = f"{sheet_name}_Variance"
    ws_out = wb_out.create_sheet(title=new_sheet_name)

    # Write header
    headers = ["FSLI", "CY", "PY"]
    ws_out.append(headers)

    # Extract and write data
    for row in ws_in.iter_rows(min_row=9, min_col=2, max_col=4, values_only=True):
        if all(v is None for v in row):
            continue
        fsli, current, prior = row
        ws_out.append([fsli, current, prior])
        

wb_out.save(output_file)
print(f"Data extracted to {output_file}")
